(function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function a(d){if(typeof d==="undefined"){return -1}for(var c=0;c<this.length;c++){if(this[c]===d){return c}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function b(d){for(var c=0;c<this.length;c++){if(d(this[c],c)===false){return}}}}}());window.TM=(function(k,j){var n=false,l={},h={},g=Array.prototype.slice,b,i=["_extend","_self","constructor","U"];function d(r){var s=typeof r;if(s!=="object"&&s!=="function"){throw new Error("Passed a "+s+", please pass an object or function which copies.")}var o=g.call(arguments,1);if(!o||!o.length){return r}for(var q=0;q<o.length;q++){var u=o[q],t=typeof u;if(t!=="object"&&t!=="function"){throw new Error("Please pass objects to copy.")}for(var p in u){if(i.indexOf(p)>-1){continue}if(u.hasOwnProperty(p)){r[p]=u[p]}}}return r}function f(p){var o=p.lastIndexOf(".");return o===-1?["com",p]:[p.substring(0,o),p.substring(o+1)]}function m(o){console.log(o)}var a=(function(){var o;return{copy:d,createEntrance:function(){if(o){return}var q=k.body.getAttribute("data-page");if(!q){return}var p=b.pages&&b.pages[q]&&b.pages[q].controller;if(p&&this.hasClass(p)){o=this.createInstance(p)}else{throw new Error("Controller class "+p+" was not found for page "+q)}},createInstance:function(q){var p=this.getClass(q);return p.createInstance.apply(p,g.call(arguments,1))},hasClass:function(r){if(!r){return false}var q=f(r);var p=c.getNamespace(q[0]);return p&&p.hasClass(q[1])},getClass:function(r){var q=f(r);var p=c.getNamespace(q[0]);if(!p){throw new Error("Failed to load class from "+r)}return p.getClass(q[1])},printClasses:function(){for(var p in h){h[p].printClasses()}},printNamespaces:function(){var q=[];for(var p in h){q.push(p)}m("All namespaces: "+q.join(", "))}}})();var c=(function(){var o=function o(u){var v=u,t,w,y,s,x;d(this,{construct:function(z){if(!z||typeof z!=="function"){throw new Error("Passed arg should be a function.")}x=z;return this},extend:function(z){t=z;return this},getParams:function(){if(!x){x=function(){}}return{className:v,parentPath:w||"thinkmvc.Base",extendedObj:t,sharedObj:s,srcFunc:x}},inherit:function(z){w=z;return this},share:function(z){s=z;return this}})};var r=function r(x,u){var t=x.className,w=x.srcFunc;var s=(function(){if(!t){throw new Error("Class name is invalid.")}var A=u.classes;if(!(A[t] instanceof o)){throw new Error("The class "+t+" was not declared.")}var y=v(w),z;if(x.sharedObj){z=x.sharedObj;if(typeof z==="function"){z=z.call()}d(y,z)}return A[t]=y}());function v(z){if(!z){z=function(){}}else{if(typeof z!=="function"){throw new Error("Passed arg should be a function.")}}var y=function(){if((typeof j!=="undefined"&&this===j)||(typeof j.global!=="undefined"&&this===j.global)){throw new Error("Please use new operator to create an object!")}z.apply(this,arguments);if(typeof this.initialize!=="undefined"&&this.constructor.className===t){this.initialize.apply(this,arguments)}};y.prototype=z.prototype;y.prototype.constructor=y;y.prototype.constructor.className=t;y.prototype.DEBUG_MODE=n;y.prototype.U=a;y.prototype.getClassPath=function(){return u.name+"."+t};y.prototype.parentClass=Object;return y}d(this,{extend:function(y){if(!y){return this}if(typeof y==="function"){y=y.call()}if(typeof y!=="object"){throw new Error("Passed arg should be an object or a function which returns an object.")}d(s.prototype,y);return this},getClass:function(){return s},inherit:function(B){if(!B){return this}if(typeof B!=="string"){throw new Error("Passed arg should be a string.")}var z=a.getClass(B);if(typeof z!=="function"){throw new Error("Parent class is invalid")}var y=s,A=function(){z.apply(this,arguments);y.apply(this,arguments)};A.prototype=Object.create(z.prototype);d(A.prototype,y.prototype);A.prototype.constructor=A;A.prototype.constructor.className=y.className;A.prototype.parentClass=z;d(A,z);d(A,y);u.classes[y.className]=s=A;return this}})};var q=function q(u){var s=(function(z){var w=z.toLowerCase().replace(/^com\.?|%S*/,"");if(/class|classes/.test(w)){throw new Error("'class' is a reserved word in namespace!")}var y=l;if(w!==""){var A=w.split(".");for(var x=0;x<A.length;x++){var v=A[x];y=y[v]||(y[v]={})}}return{classes:y.classes||(y.classes={}),dir:y,name:(w?"com.":"com")+w}})(u);function t(x){if(!x){throw new Error("Passed arg is invalid.")}var v=x.getParams();var w=(new r(v,s)).extend(v.extendedObj).inherit(v.parentPath).getClass();if(n){m("A new class "+s.name+"."+w.className+" was created.")}return w}d(this,{getClass:function(w){var v=s.classes[w];if(!v){throw new Error("The class "+this.getName()+"."+w+" does not exist.")}if(v instanceof o){return t(v)}return v},getName:function(){return s.name},hasClass:function(v){return v&&v in s.classes},printClasses:function(){var w=[];for(var v in s.classes){w.push(v)}m("[Namespace]: "+s.name+"; [Classes]: "+w.join(", "))},register:function(w){var v=s.classes;if(v[w]){throw new Error("The class "+w+" alredy exists.")}return v[w]=new o(w)}})};function p(t){if(t!=="com"&&!/^com\./.test(t)){t="com."+t}if(h[t]){return h[t]}var s=new q(t);return h[s.getName()]=s}return{declare:function(u){if(typeof u!=="string"){throw new Error("Passed args should be a string. E.g. the string can be com.animal.Dog or Dog or animal.Dog")}var t=f(u);var s=p(t[0]);return s.register(t[1])},getNamespace:p}}());var e=(function(){var F={},r,o,q=[],z={COMPLETED:1,HAS_DEPENDENCIES:2,PENDING:3,READY:4};function u(){for(var G in F){if(F[G]!==z.COMPLETED){return false}}return true}function w(){var G=function(H){a.createEntrance()};if(p()){G();return}if(k.addEventListener){k.addEventListener("DOMContentLoaded",G,false);j.addEventListener("load",G,false)}else{if(k.attachEvent){k.attachEvent("onreadystatechange",function(){if(p()){G()}});j.attachEvent("onload",G)}}}function y(I,H){if(!I){return}if(b&&b.baseUrl&&I.indexOf("http")<0){I=b.baseUrl+"/"+I;if(n){I+="?time="+new Date().getTime()}}var G=k.createElement("script");G.setAttribute("id",H);G.setAttribute("src",I);G.setAttribute("type","text/javascript");if(H==="config"){G.setAttribute("async","async")}else{G.setAttribute("defer","defer")}if(G.addEventListener){G.addEventListener("load",t)}else{G.attachEvent("onreadystatechange",t)}return G}function x(){var G=[];for(var H in F){if(F[H]===z.READY){G.push(H);D(H,z.PENDING)}}return G}function A(I){if(!I){return}var G=B();for(var H=0;G&&H<G.length;H++){if(I===G[H].getAttribute("id")){return G[H]}}}function B(){if(!o){o=[];var G=k.getElementsByTagName("script");for(var H=0;H<G.length;H++){o.push(G[H])}}return o}function t(G){var I=G.currentTarget||G.srcElement;var H=I.getAttribute("id");if(!H){return}if(n){m("Downloading module "+H+" was completed.")}if(F.hasOwnProperty(H)){D(H,z.COMPLETED)}v();if(u()){w()}else{s()}}function C(){var G=k&&k.body;if(!G){setTimeout(C,1);return}var I=G.getAttribute("data-page");if(!I){return}var H=b.pages[I]&&b.pages[I].module;if(!H){throw new Error("JS module was not found for page "+I)}E(H)}function p(){var G=k&&k.body&&k.readyState;return G==="complete"||G==="interactive"}function s(){var G=x();if(!(G&&G.length)){return}var H=k.createDocumentFragment();G.forEach(function(J){var I=y(b.modules[J],J);if(!I){throw new Error("The path of loading the resource is incorrect! resource:"+J)}D(J,z.PENDING);if(n){m("Going to to load resource: "+J)}r.appendChild(I)});r.appendChild(H)}function E(H){if(!H){return}if(F.hasOwnProperty(H)){D(H);return}if(A(H)){D(H,z.COMPLETED);return}var I=b.dependencies&&b.dependencies[H];if(I&&I.length){D(H,z.HAS_DEPENDENCIES);for(var G=0;G<I.length;G++){E(I[G])}}else{D(H,z.READY)}}function D(G,H){if(!G){throw new Error("Module is not passed.")}if(typeof H!=="undefined"){F[G]=H}H=F[G];if(b.forceSync&&H===z.READY){q.unshift(G)}}function v(){for(var H in F){if(F[H]!==z.HAS_DEPENDENCIES){continue}var G=true;b.dependencies[H].forEach(function(I){if(F[I]!==z.COMPLETED){return G=false}});if(G){F[H]=z.READY}}}return{configure:function(G){if(!(G&&G.pages&&G.modules)){throw new Error("Configuration is invalid.")}b=G;n=b.debugEnabled;C()},start:function(){B().forEach(function(G){if(!r){r=G.parentNode}var H=G.getAttribute("data-first");if(!H){return}var G=A("first");if(!G){r.appendChild(y(H,"first"))}return false})}}}());(function(){setTimeout(function(){e.start()},0)}());return{configure:function(o){return e.configure(o)},declare:function(o){return c.declare(o)}}}(document,window));TM.declare("thinkmvc.Base").extend({debug:function(a){console.log(a)},destroy:function(){var a=this._proxiedCallbacks;if(!a){return}var c={removeReferenceForGC:true};for(var b in a){a[b].call(null,c);a[b]=null}this._proxiedCallbacks=null},getClassName:function(){return this.constructor.className},isInstanceOf:function(a){if(typeof a==="string"){a=this.U.getClass(a)}if(this instanceof a){return true}if(a===Object||!this.parentClass){return false}return this.parentClass.prototype.isInstanceOf(a)},invoke:function(b){var c=b&&b.split(":");if(!(c&&c.length===2)){throw new Error("Method "+b+" was not found.")}var e=c[0]||"thinkmvc.Base",a=c[1],d=this.U.getClass(e).prototype[a];if(d){d.apply(this,Array.prototype.slice.call(arguments,1))}else{throw new Error("Method "+b+" was not found.")}},proxy:function(e,d){var b=d||(function(h){if(typeof h!=="function"){throw new Error("Passed arg is not a function.")}if(h.hasOwnProperty("name")){return h.name}var g=/function\s+(.+)\(/i;var f=g.exec(h.toString());return f[1]})(e);if(!b){throw new Error("Callback name is not assigned.")}var a=this,c=a._proxiedCallbacks||(a._proxiedCallbacks={});return c[b]||(c[b]=function(){if(arguments.length&&arguments[0].removeReferenceForGC){return a=null}return e.apply(a,arguments)})},proto:function(a,b){if(!(a&&typeof a==="string")){return}var c=this.constructor.prototype;if(arguments.length>1){c[a]=b}return c[a]},toString:function(){var c=[],b=[];for(var a in this){if(this[a] instanceof Function){b.push(a)}else{if(this[a] instanceof Object){c.push(a+"(object)")}else{c.push(a+"="+this[a])}}}return"[Class]: "+this.getClassName()+"; [Functions]: "+b.join(", ")+"; [Properties]: "+c.join(", ")}}).share({createInstance:function(){var a=Object.create(this.prototype);this.apply(a,arguments);return a}});TM.declare("thinkmvc.evt.Event").extend({execute:function(e,d){var a=this._callbackList;if(!(a&&a.length)){return}var b={data:d,target:e};for(var c=0;c<a.length;c++){a[c](b)}if(this.DEBUG_MODE){this.debug("Successfully triggered the event "+this._name+" on "+e.getClassPath())}},getName:function(){return this._name},initialize:function(a){this._name=a},push:function(b){var a=this._callbackList||(this._callbackList=[]);Array.prototype.push.apply(a,arguments);return this},remove:function(c){if(!c){this._callbackList=null;return this}var b,a=this._callbackList;while(b=a.lastIndexOf(c)){a.splice(b,1)}return this}});TM.declare("thinkmvc.evt.EventManager").extend({off:function(a,c){var b=this._events;if(!b){return this}if(!a){this._events=null}else{if(a in b){b[a].remove(c)}}return this},on:function(a,c){var b=this._events||(this._events={});if(!b[a]){b[a]=this.U.createInstance("thinkmvc.evt.Event",a)}b[a].push(c);return this},trigger:function(a,c){var b=this._events;if(b&&(a in b)){b[a].execute(this,c)}return this}});TM.declare("thinkmvc.Model").inherit("thinkmvc.evt.EventManager").extend({attributes:[],vewPath:"",change:function(){return this.trigger("change")},destroy:function(){if(this._view){this._view.destroy();this._view=null}this.trigger("destory").off()},initialize:function(){var a=this.viewPath;if(a){this._view=this.U.createInstance(a,this)}}});TM.declare("thinkmvc.Collection").inherit("thinkmvc.evt.EventManager").extend({add:function(){var b=this._Model||(this._Model=this.U.getClass(this.modelPath));var a=b.createInstance.apply(b,arguments);this._models.push(a);return this.trigger("add",a)},change:function(a){if(a!==false){this.each(function(b){b.change()})}return this.trigger("change")},destroy:function(a){if(a!==false){this.each(function(b){b.destroy()})}this._models=null;this._view=null;this.trigger("destroy").off()},each:function(d){if(!d||this.isEmpty()){return}var c=this._models,b=this._models.length;for(var a=0;a<b;a++){d(c[a],a)}},get:function(a){if(a>=0&&a<this._models.length){return this._models[a]}},initialize:function(){if(!this.modelPath){throw new Error("Model path is not set.")}this._models=[];if(this.viewPath){this._view=this.U.createInstance(this.viewPath,this)}},isEmpty:function(){return this.size()<=0?true:false},last:function(){var a=this.size()-1;return a>=0?this._models[a]:null},remove:function(b){if(typeof b==="undefined"){this._models=[];this.trigger("remove:all")}else{var a=this.get(b);if(a){this._models.splice(b,1);a.destroy()}this.trigger("remove:one",a?true:false)}return this.trigger("remove")},size:function(){var a=this._models;return a?a.length:0}});TM.declare("thinkmvc.ui.Common").extend({$:function(a){var b=this._$root||(this._$root=$(this.rootNode||"html"));return a&&b.find(a)},destroy:function(){this.invoke(":destroy");var b=this._el;if(!b){return}for(var a in b){b[a]=null}this._el=null},initialize:function(){this.refreshElements();this.initEvents&&this.initEvents()},refreshElements:function(){var b=this.selectors,c=this._el||(this._el={});if(!b){return}for(var a in b){c["$"+a]=this.$(b[a])}}});TM.declare("thinkmvc.Controller").inherit("thinkmvc.ui.Common").extend({eventSplitter:/^(\S+)\s*(.*)$/,undelegatableEvents:[],initEvents:function(){var l=this.events;if(!l){return}!this._$root&&this.$();var h=this._$root,f=$(document),c=$(window),k=this.eventSplitter,b=this.undelegatableEvents;for(var i in l){var a=l[i];if(typeof a!=="string"||!(a in this)){throw new Error("Failed to find method "+a)}var j=this.proxy(this[a],a);var g=i.match(k),e=g[1],d=g[2];if(d){if(d==="document"){f.off(e,j).on(e,j)}else{if(d==="window"){c.off(e,j).on(e,j)}else{if(b.indexOf(e)>-1){this._$(d).off(e,j).on(e,j)}else{h.off(e,d,j).on(e,d,j)}}}}else{h.off(e,j).on(e,j)}}}});TM.declare("thinkmvc.View").inherit("thinkmvc.ui.Common").extend({destroy:function(){this.invoke("thinkmvc.ui.Common:destroy");this._model=null},initEvents:function(){var b=this.events;if(!(b&&this._model)){return}for(var a in b){var d=b[a];if(typeof d!=="string"||!(d in this)){throw new Error("Failed to find method "+d)}var c=this.proxy(this[d],d);this._model.off(a,c).on(a,c)}},initialize:function(a){this._model=a;this.invoke("thinkmvc.ui.Common:initialize")}});TM.declare("thinkmvc.val.Error").extend({initialize:function(b,a){this._id=b;this._message=a},getId:function(){return this._id},getMessage:function(){return this._message}});TM.declare("thinkmvc.val.Validator").extend({errorType:"thinkmvc.val.Error",createError:function(c,b){var a=this.U.createInstance(this.errorType,c,b);this._errors.push(a)},getErrors:function(){return this._errors},getMessage:function(){if(!this.hasErrors()){return}var a=null;this._errors.forEach(function(c,b){if(b===0){a=c.getMessage()}else{a+="<br>"+c.getMessage()}});return a},hasErrors:function(){return this._errors&&this._errors.length?true:false},initialize:function(b){if(!b){return}var d=this._errors||(this._errors=[]);if(b.validate){b.validate(this);return}var c=/^validate/;for(var a in b){if(c.text(a)&&typeof b[a]==="function"){b[a].call(b,this)}}}});